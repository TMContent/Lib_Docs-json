{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "0",
      "Content_Hash": "0"
    },
    "Metadata": [
      {
        "Id": [
          "32a7e94c-5a14-4619-82aa-be368502f0dc"
        ],
        "Library_Id": [
          "eb39d862-f752-4d1c-ab6e-14ed697397c0"
        ],
        "Title": [
          "Case Study - Fix Duplicate Article GUIDs created by Library split"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "false",
          "DataType": "wikitext"
        },
        "Data": [
          "This article shows a script that was used on the 3.0 release to fix the 'duplicate libraries issue' found after importing multiple libraries that have multiple Article with the same GUID.\n\nThe first code samples show how to access the WebServices via the C# file created from the WebServices WSDL\n\n===Get guidanceItems and list them on a treeview===\n{{{\nvar tmWebServices = new TM_WebServices();\n\nvar libraryName = \".NET 3.5\";\n\nvar library = tmWebServices.GetLibraryByName(libraryName);\nvar guidanceItems = tmWebServices.GetGuidanceItemsInLibrary(library.id.guid());\n\nvar mappedItems = new Dictionary< string, List< TM_GuidanceItem>>();\n\nforeach(var guidanceItem in guidanceItems)\n\tmappedItems.add(guidanceItem.Title, guidanceItem);\n\t\nvar treeView = panel.clear().add_TreeView_with_PropertyGrid(false).sort();\nforeach(var mappedItem in mappedItems)\n\ttreeView.add_Node(mappedItem.Key)\n\t\t\t .add_Nodes(mappedItem.Value);\n\t\n//return mappedItems;\n\n//using O2.SecurityInnovation.TEAM Mentor\n//O2File:TM_WebServices.cs\n//O2File:Test_TM_Config.cs\n//O2Ref:System.Web.Services.dll\n}}}\n\n===Get all views that belong a particular library===\n{{{\nvar tmWebServices = new TM_WebServices();\n\nvar libraryName = \".NET 3.5\";\nvar libraryId = \"92718d53-36b2-47bc-b6f5-e60994385f46\".guid();\n \nvar library = tmWebServices.GetLibraryByName(libraryName);\n\nvar guidanceItems = tmWebServices.GetGuidanceItemsInLibrary(library.id.guid());\n\nvar views = tmWebServices.GetAllViews();\nvar viewsByLibrary = new Dictionary< Guid,List< View_V3>>();\nforeach(var view in views)\n\tviewsByLibrary.add(view.libraryId, view);\n\nreturn viewsByLibrary[libraryId];\n\n//using O2.SecurityInnovation.TEAM Mentor\n//O2File:TM_WebServices.cs\n//O2File:Test_TM_Config.cs\n//O2Ref:System.Web.Services.dll\n}}}\n\n===Complete script (to fix duplicate GUIDs===\n{{{\nvar tmWebServices = new TM_WebServices();\n\nAction< string,string> login_as_user = \n\t(username, passwordHash)=>{\t\t\n\t\t\t\t\ttmWebServices.CookieContainer = new System.Net.CookieContainer();\n\t\t\t\t\ttmWebServices.Url \t\t\t = Test_TM.tmWebServices;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\tvar sessionID  \t\t\t\t =  tmWebServices.Login(username, passwordHash);\n\t\t\t\t};\n\nlogin_as_user(\"editor\", Test_TM.passwordHash_Editor);    \n\n\n//var libraryName = \".NET 3.5\";\n//var libraryId = \"92718d53-36b2-47bc-b6f5-e60994385f46\".guid();\n \n//var library = tmWebServices.GetLibraryByName(libraryName);\n\nvar views = tmWebServices.GetAllViews();\nvar viewsByLibrary = new Dictionary< Guid,List< View_V3>>();\nforeach(var view in views)\n\tviewsByLibrary.add(view.libraryId, view);\n\nforeach(var library in tmWebServices.GetLibraries())\n{\n\t\"> Mapping Library: {0} \".info(library.Caption);\t\n\t\n\tvar guidanceItemsInLibrary = tmWebServices.GetGuidanceItemsInLibrary(library.Id).toList(); \n\t\n\tvar guidanceItemsById = new Dictionary< Guid,TM_GuidanceItem>();\n\tforeach(var guidanceItem in guidanceItemsInLibrary)\n\t\tguidanceItemsById.Add(guidanceItem.Id,guidanceItem);\n\t\n\tvar guidanceItems_Original_ById = new Dictionary< Guid,Guid>();\n\tforeach(var guidanceItem in guidanceItemsInLibrary)\n\t\tif (guidanceItem.Id_Original != Guid.Empty)\n\t\t\tguidanceItems_Original_ById.Add(guidanceItem.Id_Original,guidanceItem.Id); \n\t\n\tvar viewsInLibrary = viewsByLibrary[library.Id]; \n\t\n\tforeach(var viewInLibrary in  viewsInLibrary)\n\t{\n\t\t\"Mapping view: {0} \".info(viewInLibrary.caption);\t\n\t\t\n\t\tvar guidanceItemsToAdd = new List< Guid>();\n\t\tvar guidanceItemsToRemove = new List< Guid>();\n\t\t\n\t\tforeach(var guid in viewInLibrary.guidanceItems.toList())\n\t\t\tif(guidanceItemsById.hasKey(guid).isFalse())\t\t\n\t\t\t{\n\t\t\t\tif (guidanceItems_Original_ById.hasKey(guid))\n\t\t\t\t{\n\t\t\t\t\tvar originalGuid = guidanceItems_Original_ById[guid];\n\t\t//\t\t\t\"***** guidanceItem OK via Original found: {0} -> {1}\".debug(guid, originalGuid);\n\t\t\t\t\tguidanceItemsToAdd.Add(originalGuid);\n\t\t\t\t\tguidanceItemsToRemove.Add(guid);\t\t\t\n\t\t\t\t}\n\t\t\t\telse \n\t\t\n\t\t\t\t\t\"******guidanceItem not found: {0}\".error(guid);\n\t\t\t}\n\t\t\t\n\t\tif (guidanceItemsToAdd.size() > 0)\n\t\t{\n\t\t\tvar result1 = tmWebServices.RemoveGuidanceItemsFromView(\tviewInLibrary.viewId, guidanceItemsToRemove.ToArray());\n\t\t\tvar result2 = tmWebServices.AddGuidanceItemsToView(\tviewInLibrary.viewId, guidanceItemsToAdd.ToArray()); \t \n\t\t\t\"   save result: {0} , {1} , removed: {2}, added: {3}\".debug(result1, result2, guidanceItemsToRemove.size(), guidanceItemsToAdd.size());\n\t\t}\n\t}\t\n }\n return \"all Done\";\n\n//using O2.SecurityInnovation.TEAM Mentor\n//O2File:TM_WebServices.cs\n//O2File:Test_TM_Config.cs\n//O2Ref:System.Web.Services.dll\n}}}\n\n"
        ]
      }
    ]
  }
}